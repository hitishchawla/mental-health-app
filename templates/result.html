<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prediction Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f7f9fc;
            padding-top: 50px;
        }
        .result-container {
            max-width: 1000px;
            margin: auto;
            padding: 40px 60px;
            border-radius: 15px;
            background-color: #ffffff;
            box-shadow: 0px 8px 20px rgba(0,0,0,0.1);
        }
        .result-title {
            font-size: 2rem;
            font-weight: bold;
            color: #343a40;
        }
        .result-value {
            font-size: 1.5rem;
            margin-top: 20px;
            color: #007bff;
        }
        .tooltip-icon {
            cursor: pointer;
            font-size: 1rem;
            color: #888;
            margin-left: 6px;
        }
        .confidence-chart {
            margin-top: 40px;
            position: relative;
            width: 220px;
            height: 220px;
            margin-left: auto;
            margin-right: auto;
        }
        .confidence-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .back-btn {
            margin-top: 40px;
        }
    </style>
</head>
<body>

<div class="result-container text-center">
    <div class="result-title">Mental Health Prediction</div>
    <div class="result-value">
        {{ prediction }}
        <span 
            class="tooltip-icon" 
            data-bs-toggle="tooltip" 
            title="Based on your inputs, our model predicts your current mental health risk.">
            &#9432;
        </span>
    </div>
    

    <div style="font-weight: bold; margin-top: 20px;">
    Your Mental Health Analysis
    <span data-bs-toggle="tooltip" title="These charts reflect the factors contributing to your mental health score.">
        &#9432;
    </span>
    </div>
      


    <!-- Confidence Gauge Canvas -->
    <div style="margin-top: 30px; display: flex; justify-content: center;">
        <canvas id="confidenceGauge" width="250" height="250"></canvas>
    </div>

    <div class="mt-5 d-flex flex-wrap justify-content-center gap-4">
        <div style="width: 420px;">
            <canvas id="barChart" width="400" height="300"></canvas>
        </div>
        <div style="width: 420px;">
            <canvas id="radarChart" width="400" height="300"></canvas>
        </div>
    </div>

    <a href="/" class="btn btn-outline-primary back-btn">Try Again</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-gauges/gauge.min.js"></script>

<script>
    
    var confidenceValue = parseFloat("{{ confidence_score|default('0') }}");  // comes from Flask backend

    // Animate chart + percentage counter
    var gauge = new RadialGauge({
    renderTo: 'confidenceGauge',
    width: 300,
    height: 300,
    units: "Confidence",
    minValue: 0,
    maxValue: 100,
    value: 0,  // Start from 0
    majorTicks: [
        "0","10","20","30","40","50","60","70","80","90","100"
    ],
    minorTicks: 2,
    strokeTicks: true,
    highlights: [
        { from: 0, to: 60, color: "rgba(255,0,0, 0.5)" },
        { from: 60, to: 85, color: "rgba(255,165,0, 0.5)" },
        { from: 85, to: 100, color: "rgba(0,255,0, 0.5)" }
    ],
    colorPlate: "#fff",
    borderShadowWidth: 0,
    borders: false,
    needleType: "arrow",
    needleWidth: 2,
    animationDuration: 2000,
    animationRule: "linear",
    valueBox: true,
    valueText: confidenceValue.toFixed(1) + "%"
  }).draw();

  // Animate from 0 to confidence score
  setTimeout(() => {
    gauge.value = confidenceValue;
  }, 500);
</script>

<script>
// Replace with your actual data passed from Flask
const contributingFactors = {
    labels: ["Sleep", "Academic Pressure", "Financial Stress", "Diet", "Study Satisfaction", "Suicidal Thoughts", "Family History"],
    values: [6, 8, 7, 4, 5, 3, 2],  // Dummy values, update with real ones
};

// Bar Chart
const ctxBar = document.getElementById('barChart').getContext('2d');
new Chart(ctxBar, {
    type: 'bar',
    data: {
        labels: contributingFactors.labels,
        datasets: [{
            label: 'Score',
            data: contributingFactors.values,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Contributing Factors'
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>

<script>
// Radar Chart
const ctxRadar = document.getElementById('radarChart').getContext('2d');
new Chart(ctxRadar, {
    type: 'radar',
    data: {
        labels: contributingFactors.labels,
        datasets: [{
            label: 'User Profile',
            data: contributingFactors.values,
            fill: true,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgb(255, 99, 132)',
            pointBackgroundColor: 'rgb(255, 99, 132)'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Mental Health Profile'
            }
        },
        scales: {
            r: {
                suggestedMin: 0,
                suggestedMax: 10
            }
        }
    }
});
</script>
<script>
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>

</body>
</html>
